import {
  Plugin
} from "./chunk-CQEMCDN3.js";
import "./chunk-MJOZMRNF.js";

// node_modules/.pnpm/@chatwoot+prosemirror-schema@1.2.1/node_modules/@chatwoot/prosemirror-schema/src/plugins/image.js
function replaceImage(currentUrl, newUrl, view) {
  view.state.doc.descendants((node, pos) => {
    if (node.type.name === "image" && node.attrs.src === currentUrl) {
      const tr = view.state.tr.setNodeMarkup(pos, null, {
        ...node.attrs,
        src: newUrl
      });
      view.dispatch(tr);
    }
  });
}
var imagePastePlugin = (uploadImage) => new Plugin({
  props: {
    /**
     * Handles the paste event in the editor.
     *
     * @param {EditorView} view - The ProseMirror editor view.
     * @param {Event} event - The paste event.
     * @param {Slice} slice - The ProseMirror Slice object representing the pasted content.
     */
    handlePaste(view, event, slice) {
      const imageUrls = [];
      slice.content.descendants((node) => {
        if (node.type.name === "image") {
          imageUrls.push(node.attrs.src);
        }
      });
      Promise.all(imageUrls.map(async (url) => {
        try {
          const newUrl = await uploadImage(url);
          replaceImage(url, newUrl, view);
        } catch (error) {
          console.error("Error uploading image:", error);
        }
      }));
    }
  }
});
var image_default = imagePastePlugin;
export {
  image_default as default
};
//# sourceMappingURL=@chatwoot_prosemirror-schema_src_plugins_image.js.map
