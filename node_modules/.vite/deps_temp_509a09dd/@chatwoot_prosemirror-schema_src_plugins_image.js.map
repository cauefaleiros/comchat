{
  "version": 3,
  "sources": ["../../.pnpm/@chatwoot+prosemirror-schema@1.2.1/node_modules/@chatwoot/prosemirror-schema/src/plugins/image.js"],
  "sourcesContent": ["import { Plugin } from \"prosemirror-state\";\n\n/**\n * Replaces an image node in the editor with a new image URL.\n *\n * @param {string} currentUrl - The current URL of the image to be replaced.\n * @param {string} newUrl - The new URL to replace the current image with.\n * @param {EditorView} view - The ProseMirror editor view.\n */\nfunction replaceImage(currentUrl, newUrl, view) {\n  view.state.doc.descendants((node, pos) => {\n    if (node.type.name === \"image\" && node.attrs.src === currentUrl) {\n      const tr = view.state.tr.setNodeMarkup(pos, null, {\n        ...node.attrs,\n        src: newUrl,\n      });\n      view.dispatch(tr);\n    }\n  });\n}\n\n/**\n * Creates a ProseMirror plugin that handles image pasting and uploading.\n *\n * @param {Function} uploadImage - A function that takes an image URL and returns a Promise\n * that resolves to the new URL after uploading.\n * @returns {Plugin} A ProseMirror plugin that handles image pasting.\n */\nconst imagePastePlugin = (uploadImage) =>\n  new Plugin({\n    props: {\n      /**\n       * Handles the paste event in the editor.\n       *\n       * @param {EditorView} view - The ProseMirror editor view.\n       * @param {Event} event - The paste event.\n       * @param {Slice} slice - The ProseMirror Slice object representing the pasted content.\n       */\n      handlePaste(view, event, slice) {\n        const imageUrls = [];\n        slice.content.descendants((node) => {\n          if (node.type.name === \"image\") {\n            imageUrls.push(node.attrs.src);\n          }\n        });\n        Promise.all(imageUrls.map(async (url) => {\n          try {\n            const newUrl = await uploadImage(url);\n            replaceImage(url, newUrl, view);\n          } catch (error) {\n            console.error(\"Error uploading image:\", error);\n          }\n        }));\n      },\n    },\n  });\n\nexport default imagePastePlugin;\n"],
  "mappings": ";;;;;;AASA,SAAS,aAAa,YAAY,QAAQ,MAAM;AAC9C,OAAK,MAAM,IAAI,YAAY,CAAC,MAAM,QAAQ;AACxC,QAAI,KAAK,KAAK,SAAS,WAAW,KAAK,MAAM,QAAQ,YAAY;AAC/D,YAAM,KAAK,KAAK,MAAM,GAAG,cAAc,KAAK,MAAM;AAAA,QAChD,GAAG,KAAK;AAAA,QACR,KAAK;AAAA,MACP,CAAC;AACD,WAAK,SAAS,EAAE;AAAA,IAClB;AAAA,EACF,CAAC;AACH;AASA,IAAM,mBAAmB,CAAC,gBACxB,IAAI,OAAO;AAAA,EACT,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAQL,YAAY,MAAM,OAAO,OAAO;AAC9B,YAAM,YAAY,CAAC;AACnB,YAAM,QAAQ,YAAY,CAAC,SAAS;AAClC,YAAI,KAAK,KAAK,SAAS,SAAS;AAC9B,oBAAU,KAAK,KAAK,MAAM,GAAG;AAAA,QAC/B;AAAA,MACF,CAAC;AACD,cAAQ,IAAI,UAAU,IAAI,OAAO,QAAQ;AACvC,YAAI;AACF,gBAAM,SAAS,MAAM,YAAY,GAAG;AACpC,uBAAa,KAAK,QAAQ,IAAI;AAAA,QAChC,SAAS,OAAO;AACd,kBAAQ,MAAM,0BAA0B,KAAK;AAAA,QAC/C;AAAA,MACF,CAAC,CAAC;AAAA,IACJ;AAAA,EACF;AACF,CAAC;AAEH,IAAO,gBAAQ;",
  "names": []
}
