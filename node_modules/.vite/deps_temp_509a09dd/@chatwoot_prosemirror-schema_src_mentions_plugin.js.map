{
  "version": 3,
  "sources": ["../../.pnpm/@chatwoot+prosemirror-schema@1.2.1/node_modules/@chatwoot/prosemirror-schema/src/mentions/plugin.js"],
  "sourcesContent": ["/**\n * This file is a modified version of prosemirror-suggestions\n * https://github.com/quartzy/prosemirror-suggestions/blob/master/src/suggestions.js\n */\n\nimport { Plugin, PluginKey } from 'prosemirror-state';\nimport { Decoration, DecorationSet } from 'prosemirror-view';\n\n/**\n * Creates a function to detect if the trigger character followed by a specified number of characters\n * has been typed, starting from a new word, after a space, or after a newline.\n * @param {string} char - The trigger character to detect.\n * @param {number} [minChars=0] - The minimum number of characters that should follow the trigger character.\n * @returns {Function} A function that takes a position object and returns the match if the condition is met.\n */\nexport const triggerCharacters = (char, minChars = 0) => $position => {\n  // Regular expression to find occurrences of 'char' followed by at least 'minChars' non-space characters.\n  // It matches these sequences starting from the beginning of the text or after a space.\n  const regexp = new RegExp(`(?:^)?${char}[^\\\\s${char}]{${minChars},}`, 'g');\n\n  // Get the position before the current cursor position in the document.\n  const textFrom = $position.before();\n  // Get the position at the end of the current node.\n  const textTo = $position.end();\n\n  // Get the text between the start of the node and the cursor position.\n  const text = $position.doc.textBetween(textFrom, textTo, '\\0', '\\0');\n\n  let match;\n\n  // eslint-disable-next-line\n  while ((match = regexp.exec(text))) {\n    // Check if the character before the match is a space, start of string, or null character\n    const prefix = match.input.slice(Math.max(0, match.index - 1), match.index);\n    if (!/^[\\s\\0]?$/.test(prefix)) {\n      // If the prefix is not empty, space, or null, skip this match\n      // eslint-disable-next-line\n      continue;\n    }\n\n    const from = match.index + $position.start();\n    const to = from + match[0].length;\n\n    if (from < $position.pos && to >= $position.pos) {\n      const fullMatch = match[0];\n      // Remove trigger char and trim\n      const trimmedText = fullMatch ? fullMatch.slice(char.length) : '';\n      return { range: { from, to }, text: trimmedText };\n    }\n  }\n  return null;\n};\n\nexport const suggestionsPlugin = ({\n  matcher,\n  suggestionClass = 'prosemirror-mention-node',\n  onEnter = () => false,\n  onChange = () => false,\n  onExit = () => false,\n  onKeyDown = () => false,\n}) => {\n  return new Plugin({\n    key: new PluginKey('mentions'),\n\n    view() {\n      return {\n        update: (view, prevState) => {\n          const prev = this.key.getState(prevState);\n          const next = this.key.getState(view.state);\n\n          const moved =\n            prev.active && next.active && prev.range.from !== next.range.from;\n          const started = !prev.active && next.active;\n          const stopped = prev.active && !next.active;\n          const changed = !started && !stopped && prev.text !== next.text;\n\n          if (stopped || moved)\n            onExit({ view, range: prev.range, text: prev.text });\n          if (changed && !moved)\n            onChange({ view, range: next.range, text: next.text });\n          if (started || moved)\n            onEnter({ view, range: next.range, text: next.text });\n        },\n      };\n    },\n\n    state: {\n      init() {\n        return {\n          active: false,\n          range: {},\n          text: null,\n        };\n      },\n\n      apply(tr, prev) {\n        const { selection } = tr;\n        const next = { ...prev };\n\n        if (selection.from === selection.to) {\n          if (\n            selection.from < prev.range.from ||\n            selection.from > prev.range.to\n          ) {\n            next.active = false;\n          }\n\n          const $position = selection.$from;\n          const match = matcher($position);\n\n          if (match) {\n            next.active = true;\n            next.range = match.range;\n            next.text = match.text;\n          } else {\n            next.active = false;\n          }\n        } else {\n          next.active = false;\n        }\n\n        if (!next.active) {\n          next.range = {};\n          next.text = null;\n        }\n\n        return next;\n      },\n    },\n\n    props: {\n      handleKeyDown(view, event) {\n        const { active } = this.getState(view.state);\n\n        if (!active) return false;\n\n        return onKeyDown({ view, event });\n      },\n      decorations(editorState) {\n        const { active, range } = this.getState(editorState);\n\n        if (!active) return null;\n\n        return DecorationSet.create(editorState.doc, [\n          Decoration.inline(range.from, range.to, {\n            nodeName: 'span',\n            class: suggestionClass,\n          }),\n        ]);\n      },\n    },\n  });\n};\n"],
  "mappings": "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",
  "names": []
}
