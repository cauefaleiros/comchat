import{r as B,c as S,n as c,o as d,p as e,g as _,t as v,q as ee,i as re,f as P,H as ie,m as R,F as T,j as N,z as te,_ as se,a as U,e as oe,l as de,T as ce,a6 as ue,Y as ve,L as me}from"./_plugin-vue_export-helper-DG4P_01H.js";import{c as ne,f as fe}from"./useBranding-DmHLD-Fz.js";import{v as ge,j as pe,aV as J}from"./DashboardIcon-B95NAghS.js";import{a as ae,u as le}from"./Validators-BM89Tp7H.js";import{u as X}from"./index-DhewzwAi.js";import"./utils.esm-D6ZuPXmT.js";import"./js.cookie-Cz0CWeBA.js";import"./index-Cw6s38ZS.js";import"./index-DN3rM4CW.js";import"./Icon-Br_HG2DA.js";import"./_commonjsHelpers-BosuxZz1.js";const be={class:"flex items-start justify-between mb-3"},xe={class:"flex items-center gap-2"},he={class:"px-2 py-0.5 text-xs font-medium text-green-700 bg-green-100 dark:bg-green-900/30 dark:text-green-400 rounded"},we={class:"relative"},ke={key:0,class:"absolute right-0 mt-1 w-48 bg-white dark:bg-n-solid-6 rounded-lg shadow-lg border border-n-weak z-50"},ye={class:"py-1"},Ce=["disabled"],_e={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},$e={key:1,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},Me={class:"font-semibold text-n-slate-12 mb-2 line-clamp-2"},De={class:"text-sm text-n-slate-11 mb-4 line-clamp-2"},je={key:0,class:"flex flex-wrap gap-1 mb-3"},Ee={key:0,class:"px-2 py-0.5 text-xs font-medium text-n-slate-11 bg-n-solid-4 rounded"},ze={class:"flex items-center justify-between pt-3 border-t border-n-weak"},Be={class:"flex items-center gap-2"},Ae={class:"w-6 h-6 min-w-[24px] min-h-[24px] rounded-full flex-shrink-0 overflow-hidden"},Ie=["src","alt"],Le={key:1,class:"w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-xs font-semibold"},Pe={class:"text-xs text-n-slate-11 truncate max-w-[120px]"},Se={class:"flex items-center gap-2 text-n-slate-11"},Ve={key:0,class:"flex items-center gap-1"},qe={class:"text-xs font-medium bg-red-500 text-white px-1.5 py-0.5 rounded-full"},Te={class:"text-xs"},Z={__name:"KanbanCard",props:{conversation:{type:Object,required:!0}},emits:["dragstart","view-details","conversation-resolved"],setup(a,{emit:V}){const u=a,k=V,$=ae(),h=le(),b=B(!1),m=B(!1),x=B(!1),y=ne("labels/getLabels"),q=S(()=>u.conversation.last_non_activity_message&&u.conversation.last_non_activity_message.content||"Sem mensagens"),f=S(()=>{var t,r,p,L,C,z;return m.value?null:((r=(t=u.conversation.meta)==null?void 0:t.sender)==null?void 0:r.thumbnail)||((L=(p=u.conversation.meta)==null?void 0:p.sender)==null?void 0:L.avatar)||((z=(C=u.conversation.meta)==null?void 0:C.sender)==null?void 0:z.avatar_url)||null}),l=S(()=>!u.conversation.labels||u.conversation.labels.length===0?[]:!y.value||y.value.length===0?(console.warn("âš ï¸ Labels do store nÃ£o disponÃ­veis"),u.conversation.labels.map(o=>typeof o=="string"?{title:o,color:"#3b82f6"}:o)):u.conversation.labels.map(o=>{const t=typeof o=="string"?o:o.title,r=y.value.find(p=>p.title===t);return r?{id:r.id,title:r.title,color:r.color,description:r.description}:(console.warn(`âš ï¸ Label nÃ£o encontrada no store: ${t}`),{title:t,color:"#3b82f6"})})),w=()=>{m.value=!0},M=o=>{if(!o||typeof o!="string"||o.trim()==="")return"?";const t=o.trim().split(/\s+/).filter(r=>r.length>0);return t.length>=2?(t[0][0]+t[1][0]).toUpperCase():t.length===1&&t[0].length>0?t[0][0].toUpperCase():"?"},D=o=>{const t=o.color||"#3b82f6";return{backgroundColor:`${t}20`,color:t,borderColor:t,borderWidth:"1px",borderStyle:"solid"}},A=o=>{if(!o)return"";const r=Math.floor(Date.now()/1e3)-o;return r<60?"agora":r<3600?`${Math.floor(r/60)}m`:r<86400?`${Math.floor(r/3600)}h`:`${Math.floor(r/86400)}d`},j=o=>{const t=h.path,p=`${t.replace(/\/kanban.*$/,"")}/conversations/${u.conversation.id}`;if(console.log("ðŸš€ Navegando de:",t),console.log("ðŸš€ Para:",p),o&&(o.metaKey||o.ctrlKey)){o.preventDefault(),window.open(`${window.location.origin}${p}`,"_blank","noopener,noreferrer");return}$.push(p)},E=o=>{o.target.closest("button")||b.value||j(o)},I=()=>{b.value=!b.value},n=()=>{b.value=!1},s=()=>{n(),k("view-details",u.conversation)},i=o=>{n(),j(o)},g=async()=>{var o,t;if(n(),!x.value)try{x.value=!0;const p=h.path.match(/\/accounts\/(\d+)/);if(!p)throw new Error("NÃ£o foi possÃ­vel identificar o account ID");const C=`/api/v1/accounts/${p[1]}/conversations/${u.conversation.id}/toggle_status`;console.log("ðŸ”„ Resolvendo conversa..."),console.log("ðŸ“ URL da API:",C),console.log("ðŸ’¬ Conversa ID:",u.conversation.id);const z=await pe.post(C,{status:"resolved",snoozed_until:null});console.log("âœ… Conversa resolvida com sucesso!",z.data),X("Conversa resolvida com sucesso!"),k("conversation-resolved",u.conversation.id)}catch(r){console.error("âŒ Erro ao resolver conversa:",r);const p=((t=(o=r.response)==null?void 0:o.data)==null?void 0:t.message)||r.message||"Erro ao resolver conversa";X(p)}finally{x.value=!1}};return(o,t)=>(d(),c("div",{draggable:"true",class:"bg-white dark:bg-n-solid-3 p-4 rounded-lg border border-n-weak cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-[1.02]",onDragstart:t[1]||(t[1]=r=>o.$emit("dragstart",r)),onClick:E},[e("div",be,[e("div",xe,[e("span",he," #"+v(a.conversation.id),1),a.conversation.priority?(d(),c("span",{key:0,class:ee(["w-2 h-2 rounded-full",{"bg-red-500":a.conversation.priority==="urgent","bg-yellow-500":a.conversation.priority==="high","bg-blue-500":a.conversation.priority==="medium"}])},null,2)):_("",!0)]),e("div",we,[e("button",{onClick:P(I,["stop"]),class:"text-n-slate-10 hover:text-n-slate-12 transition-colors p-1 hover:bg-n-solid-4 rounded"},t[2]||(t[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})],-1)])),b.value?re((d(),c("div",ke,[e("div",ye,[e("button",{onClick:s,class:"w-full px-4 py-2 text-left text-sm text-n-slate-12 dark:text-n-slate-11 hover:bg-gray-50 dark:hover:bg-n-solid-5 transition-colors flex items-center gap-2"},t[3]||(t[3]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),R(" Ver Detalhes ")])),e("button",{onClick:t[0]||(t[0]=r=>i(r)),class:"w-full px-4 py-2 text-left text-sm text-n-slate-12 dark:text-n-slate-11 hover:bg-gray-50 dark:hover:bg-n-solid-5 transition-colors flex items-center gap-2"},t[4]||(t[4]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})],-1),R(" Abrir Conversa ")])),t[7]||(t[7]=e("hr",{class:"my-1 border-n-weak"},null,-1)),e("button",{onClick:g,disabled:x.value,class:"w-full px-4 py-2 text-left text-sm text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"},[x.value?(d(),c("svg",$e,t[6]||(t[6]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(d(),c("svg",_e,t[5]||(t[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)]))),R(" "+v(x.value?"Resolvendo...":"Resolver"),1)],8,Ce)])])),[[ie(ge),()=>n()]]):_("",!0)])]),e("h3",Me,v(a.conversation.meta.sender.name),1),e("p",De,v(q.value),1),l.value.length>0?(d(),c("div",je,[(d(!0),c(T,null,N(l.value.slice(0,3),r=>(d(),c("span",{key:r.id||r.title,class:"px-2 py-0.5 text-xs font-medium rounded",style:te(D(r))},v(r.title),5))),128)),l.value.length>3?(d(),c("span",Ee," +"+v(l.value.length-3),1)):_("",!0)])):_("",!0),e("div",ze,[e("div",Be,[e("div",Ae,[f.value?(d(),c("img",{key:0,src:f.value,alt:a.conversation.meta.sender.name,class:"w-full h-full object-cover",onError:w},null,40,Ie)):(d(),c("div",Le,v(M(a.conversation.meta.sender.name)),1))]),e("span",Pe,v(a.conversation.meta.sender.phone_number||"Sem telefone"),1)]),e("div",Se,[a.conversation.unread_count>0?(d(),c("div",Ve,[t[8]||(t[8]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})],-1)),e("span",qe,v(a.conversation.unread_count),1)])):_("",!0),e("span",Te,v(A(a.conversation.last_activity_at)),1)])])],32))}},Ne={class:"bg-white dark:bg-n-solid-3 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden"},Re={class:"flex items-center justify-between p-6 border-b border-n-weak"},Ue={class:"flex items-center gap-3"},Oe=["src","alt"],He={key:1,class:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-medium"},Ke={class:"text-xl font-semibold text-n-slate-12"},Fe={class:"text-sm text-n-slate-11"},Ge={class:"p-6 overflow-y-auto max-h-[calc(90vh-180px)]"},Qe={class:"mb-6"},We={class:"p-4 bg-n-solid-2 rounded-lg space-y-2"},Ye={class:"flex items-center gap-2"},Je={class:"text-n-slate-12"},Xe={key:0,class:"flex items-center gap-2"},Ze={class:"text-n-slate-12"},et={class:"grid grid-cols-2 gap-4 mb-6"},tt={class:"text-2xl font-semibold text-n-slate-12"},st={key:0,class:"mb-6"},ot={class:"flex flex-wrap gap-2"},nt={class:"mb-6"},at={class:"p-4 bg-n-solid-2 rounded-lg"},lt={class:"text-n-slate-12"},rt={class:"text-xs text-n-slate-11 mt-2"},it={class:"grid grid-cols-2 gap-4"},dt={class:"p-4 bg-n-solid-2 rounded-lg"},ct={class:"text-sm font-medium text-n-slate-12"},ut={class:"p-4 bg-n-solid-2 rounded-lg"},vt={class:"text-sm font-medium text-n-slate-12"},mt={__name:"ConversationDetailModal",props:{isOpen:{type:Boolean,default:!1},conversation:{type:Object,default:null}},emits:["close"],setup(a,{emit:V}){const u=a,k=V,$=ae(),h=le(),b=()=>{k("close")},m=S(()=>{var f;return(f=u.conversation)!=null&&f.last_non_activity_message&&u.conversation.last_non_activity_message.content||"Sem mensagens"}),x=f=>{if(!f)return"?";const l=f.split(" ");return l.length>=2?(l[0][0]+l[1][0]).toUpperCase():f.substring(0,2).toUpperCase()},y=f=>f?new Date(f*1e3).toLocaleString("pt-BR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"NÃ£o disponÃ­vel",q=()=>{b();const f=h.path,w=`${f.replace(/\/kanban.*$/,"")}/conversations/${u.conversation.id}`;console.log("ðŸš€ Navegando de:",f),console.log("ðŸš€ Para:",w),$.push(w)};return(f,l)=>(d(),U(ue,{to:"body"},[oe(ce,{name:"modal"},{default:de(()=>{var w,M,D,A,j,E,I,n,s,i,g,o,t,r,p,L,C,z,O,H,K,F,G,Q,W;return[a.isOpen?(d(),c("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:P(b,["self"])},[e("div",Ne,[e("div",Re,[e("div",Ue,[(D=(M=(w=a.conversation)==null?void 0:w.meta)==null?void 0:M.sender)!=null&&D.thumbnail?(d(),c("img",{key:0,src:a.conversation.meta.sender.thumbnail,alt:a.conversation.meta.sender.name,class:"w-10 h-10 rounded-full object-cover"},null,8,Oe)):(d(),c("div",He,v(x((E=(j=(A=a.conversation)==null?void 0:A.meta)==null?void 0:j.sender)==null?void 0:E.name)),1)),e("div",null,[e("h2",Ke,v((s=(n=(I=a.conversation)==null?void 0:I.meta)==null?void 0:n.sender)==null?void 0:s.name),1),e("p",Fe,"#"+v((i=a.conversation)==null?void 0:i.id),1)])]),e("button",{onClick:b,class:"text-n-slate-10 hover:text-n-slate-12 transition-colors p-2 hover:bg-n-solid-4 rounded-lg"},l[0]||(l[0]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Ge,[e("div",Qe,[l[3]||(l[3]=e("label",{class:"block text-sm font-medium text-n-slate-11 mb-2"},"InformaÃ§Ãµes de Contato",-1)),e("div",We,[e("div",Ye,[l[1]||(l[1]=e("svg",{class:"w-4 h-4 text-n-slate-11",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})],-1)),e("span",Je,v(((t=(o=(g=a.conversation)==null?void 0:g.meta)==null?void 0:o.sender)==null?void 0:t.phone_number)||"NÃ£o informado"),1)]),(L=(p=(r=a.conversation)==null?void 0:r.meta)==null?void 0:p.sender)!=null&&L.email?(d(),c("div",Xe,[l[2]||(l[2]=e("svg",{class:"w-4 h-4 text-n-slate-11",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1)),e("span",Ze,v(a.conversation.meta.sender.email),1)])):_("",!0)])]),e("div",et,[e("div",null,[l[4]||(l[4]=e("label",{class:"block text-sm font-medium text-n-slate-11 mb-2"},"Status",-1)),e("span",{class:ee(["inline-flex px-3 py-1 rounded-full text-xs font-medium",{"bg-green-100 text-green-700 dark:bg-green-900/30":((C=a.conversation)==null?void 0:C.status)==="open","bg-gray-100 text-gray-700 dark:bg-gray-900/30":((z=a.conversation)==null?void 0:z.status)==="resolved"}])},v(((O=a.conversation)==null?void 0:O.status)==="open"?"Aberta":"Resolvida"),3)]),e("div",null,[l[5]||(l[5]=e("label",{class:"block text-sm font-medium text-n-slate-11 mb-2"},"NÃ£o lidas",-1)),e("span",tt,v(((H=a.conversation)==null?void 0:H.unread_count)||0),1)])]),(K=a.conversation)!=null&&K.labels&&a.conversation.labels.length>0?(d(),c("div",st,[l[6]||(l[6]=e("label",{class:"block text-sm font-medium text-n-slate-11 mb-2"},"Etiquetas",-1)),e("div",ot,[(d(!0),c(T,null,N(a.conversation.labels,Y=>(d(),c("span",{key:Y,class:"px-3 py-1 text-sm bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 rounded-full"},v(Y),1))),128))])])):_("",!0),e("div",nt,[l[7]||(l[7]=e("label",{class:"block text-sm font-medium text-n-slate-11 mb-2"},"Ãšltima Mensagem",-1)),e("div",at,[e("p",lt,v(m.value),1),e("p",rt,v(y((F=a.conversation)==null?void 0:F.last_activity_at)),1)])]),e("div",it,[e("div",dt,[l[8]||(l[8]=e("div",{class:"flex items-center gap-2 text-n-slate-11 mb-1"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",{class:"text-sm"},"Criada em")],-1)),e("p",ct,v(y((G=a.conversation)==null?void 0:G.created_at)),1)]),e("div",ut,[l[9]||(l[9]=e("div",{class:"flex items-center gap-2 text-n-slate-11 mb-1"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})]),e("span",{class:"text-sm"},"Canal")],-1)),e("p",vt,v(((W=(Q=a.conversation)==null?void 0:Q.meta)==null?void 0:W.channel)||"API"),1)])])]),e("div",{class:"flex items-center justify-end gap-3 p-6 border-t border-n-weak bg-n-solid-2"},[e("button",{onClick:b,class:"px-4 py-2 text-sm font-medium text-n-slate-11 hover:text-n-slate-12 transition-colors"}," Fechar "),e("button",{onClick:q,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors"}," Abrir Conversa ")])])])):_("",!0)]}),_:1})]))}},ft=se(mt,[["__scopeId","data-v-f6b9cbbc"]]),gt={class:"flex flex-col h-full bg-n-solid-1 min-w-full"},pt={class:"p-4 border-b border-n-weak bg-n-solid-2"},bt={class:"flex items-center justify-between"},xt=["disabled"],ht={key:0},wt={key:1},kt={key:0,class:"flex items-center justify-center flex-1"},yt={key:1,class:"flex-1 overflow-x-auto p-4"},Ct={class:"flex gap-4 h-full min-w-max"},_t={class:"flex flex-col w-80 bg-n-solid-2 rounded-lg"},$t={class:"p-4 border-b border-n-weak"},Mt={class:"flex items-center justify-between"},Dt={class:"px-2 py-1 text-xs font-medium text-n-slate-11 bg-n-solid-3 rounded"},jt={class:"p-4 border-b border-n-weak"},Et={class:"flex items-center justify-between"},zt={class:"flex items-center gap-2"},Bt={class:"font-semibold text-n-slate-12"},At={class:"px-2 py-1 text-xs font-medium text-n-slate-11 bg-n-solid-3 rounded"},It=["onDrop"],Lt={__name:"Index",setup(a){const V=fe(),u=B(null),k=B(!1),$=B(null),h=B(!1),b=ne("labels/getLabels"),m=ve({semEtiqueta:[]}),x=S(()=>b.value||[]),y=S(()=>{const n=m.semEtiqueta.length,s=x.value.reduce((i,g)=>i+f(g.title),0);return n+s>0}),q=n=>m[n]||[],f=n=>{var s;return((s=m[n])==null?void 0:s.length)||0},l=async()=>{h.value=!0;try{console.log("ðŸ” Buscando conversas...");const n=await J.get({status:"open",assigneeType:"all",page:1,sortBy:"last_activity_at"});console.log("ðŸ“¦ Resposta da API:",n),console.log("ðŸ“¦ response.data:",n.data),console.log("ðŸ“¦ response.data.data:",n.data.data),n.data&&n.data.data&&n.data.data.payload?(console.log("âœ… Total de conversas:",n.data.data.payload.length),w(n.data.data.payload)):(console.warn("âš ï¸ Nenhuma conversa encontrada na resposta"),console.log("Estrutura recebida:",n.data))}catch(n){console.error("âŒ Erro ao buscar conversas:",n)}finally{h.value=!1}},w=n=>{m.semEtiqueta=[],x.value.forEach(s=>{m[s.title]=[]}),n.forEach(s=>{if(!s.labels||s.labels.length===0)m.semEtiqueta.push(s);else{const i=s.labels[0];m[i]!==void 0?m[i].push(s):m.semEtiqueta.push(s)}})},M=(n,s)=>{u.value=s,n.dataTransfer.effectAllowed="move"},D=async(n,s)=>{if(n.preventDefault(),!u.value)return;const i=u.value.id;for(const g in m){const o=m[g].findIndex(t=>t.id===i);if(o!==-1){m[g].splice(o,1);break}}s===null?(u.value.labels=[],m.semEtiqueta.push(u.value)):(u.value.labels=[s],m[s]||(m[s]=[]),m[s].push(u.value));try{await A(i,s)}catch(g){console.error("Erro ao atualizar labels:",g),l()}u.value=null},A=async(n,s)=>{try{const i=s===null?[]:[s];await J.updateLabels(n,i),console.log(`Labels da conversa ${n} atualizadas para:`,i)}catch(i){throw console.error("Erro ao atualizar labels:",i),i}},j=()=>{l()},E=n=>{$.value=n,k.value=!0},I=()=>{k.value=!1,$.value=null};return me(async()=>{await V.dispatch("labels/get"),await l()}),(n,s)=>(d(),c("div",gt,[e("div",pt,[e("div",bt,[s[5]||(s[5]=e("h1",{class:"text-2xl font-semibold text-n-slate-12"},"Kanban de Conversas",-1)),e("button",{onClick:j,disabled:h.value,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50"},[h.value?(d(),c("span",ht,"Carregando...")):(d(),c("span",wt,"ðŸ”„ Atualizar"))],8,xt)])]),h.value&&!y.value?(d(),c("div",kt,s[6]||(s[6]=[e("div",{class:"text-center"},[e("div",{class:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e("p",{class:"text-n-slate-11"},"Carregando conversas...")],-1)]))):(d(),c("div",yt,[e("div",Ct,[e("div",_t,[e("div",$t,[e("div",Mt,[s[7]||(s[7]=e("div",{class:"flex items-center gap-2"},[e("span",{class:"w-3 h-3 rounded-full bg-gray-400"}),e("h2",{class:"font-semibold text-n-slate-12"},"SEM ETIQUETA")],-1)),e("span",Dt,v(m.semEtiqueta.length),1)])]),e("div",{class:"flex-1 p-3 overflow-y-auto space-y-3",onDrop:s[0]||(s[0]=i=>D(i,null)),onDragover:s[1]||(s[1]=P(()=>{},["prevent"])),onDragenter:s[2]||(s[2]=P(()=>{},["prevent"]))},[(d(!0),c(T,null,N(m.semEtiqueta,i=>(d(),U(Z,{key:i.id,conversation:i,onDragstart:g=>M(g,i),onViewDetails:E},null,8,["conversation","onDragstart"]))),128))],32)]),(d(!0),c(T,null,N(x.value,i=>(d(),c("div",{key:i.title,class:"flex flex-col w-80 bg-n-solid-2 rounded-lg"},[e("div",jt,[e("div",Et,[e("div",zt,[e("span",{class:"w-3 h-3 rounded-full ring-1 ring-black/10 dark:ring-white/20",style:te({backgroundColor:i.color})},null,4),e("h2",Bt,v(i.title.toUpperCase()),1)]),e("span",At,v(f(i.title)),1)])]),e("div",{class:"flex-1 p-3 overflow-y-auto space-y-3",onDrop:g=>D(g,i.title),onDragover:s[3]||(s[3]=P(()=>{},["prevent"])),onDragenter:s[4]||(s[4]=P(()=>{},["prevent"]))},[(d(!0),c(T,null,N(q(i.title),g=>(d(),U(Z,{key:g.id,conversation:g,onDragstart:o=>M(o,g),onViewDetails:E},null,8,["conversation","onDragstart"]))),128))],40,It)]))),128))])])),oe(ft,{"is-open":k.value,conversation:$.value,onClose:I},null,8,["is-open","conversation"])]))}},Ft=se(Lt,[["__scopeId","data-v-bd950ae3"]]);export{Ft as default};
//# sourceMappingURL=Index-C0JjLgLE.js.map
