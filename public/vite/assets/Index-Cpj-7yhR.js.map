{"version":3,"file":"Index-Cpj-7yhR.js","sources":["../../../app/javascript/dashboard/routes/dashboard/kanban/KanbanCard.vue","../../../app/javascript/dashboard/routes/dashboard/kanban/ConversationDetailModal.vue","../../../app/javascript/dashboard/routes/dashboard/kanban/Index.vue"],"sourcesContent":["<template>\r\n  <div\r\n    draggable=\"true\"\r\n    class=\"bg-white dark:bg-n-solid-3 p-4 rounded-lg border border-n-weak cursor-move hover:shadow-lg transition-all duration-200 hover:scale-[1.02]\"\r\n    @dragstart=\"$emit('dragstart', $event)\"\r\n  >\r\n    <!-- Header do Card -->\r\n    <div class=\"flex items-start justify-between mb-3\">\r\n      <div class=\"flex items-center gap-2\">\r\n        <span class=\"px-2 py-0.5 text-xs font-medium text-green-700 bg-green-100 dark:bg-green-900/30 dark:text-green-400 rounded\">\r\n          #{{ conversation.id }}\r\n        </span>\r\n        <span\r\n          v-if=\"conversation.priority\"\r\n          class=\"w-2 h-2 rounded-full\"\r\n          :class=\"{\r\n            'bg-red-500': conversation.priority === 'urgent',\r\n            'bg-yellow-500': conversation.priority === 'high',\r\n            'bg-blue-500': conversation.priority === 'medium',\r\n          }\"\r\n        ></span>\r\n      </div>\r\n      \r\n      <!-- Menu Dropdown -->\r\n      <div class=\"relative\">\r\n        <button \r\n          @click.stop=\"toggleMenu\"\r\n          class=\"text-n-slate-10 hover:text-n-slate-12 transition-colors p-1 hover:bg-n-solid-4 rounded\"\r\n        >\r\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z\" />\r\n          </svg>\r\n        </button>\r\n\r\n        <!-- Dropdown Menu -->\r\n        <div\r\n          v-if=\"showMenu\"\r\n          v-on-click-outside=\"closeMenu\"\r\n          class=\"absolute right-0 mt-1 w-48 bg-white dark:bg-n-solid-4 rounded-lg shadow-lg border border-n-weak z-50\"\r\n        >\r\n          <div class=\"py-1\">\r\n            <button\r\n              @click=\"viewDetails\"\r\n              class=\"w-full px-4 py-2 text-left text-sm text-n-slate-12 hover:bg-n-solid-3 transition-colors flex items-center gap-2\"\r\n            >\r\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n              </svg>\r\n              Ver Detalhes\r\n            </button>\r\n            <button\r\n              @click=\"openConversation\"\r\n              class=\"w-full px-4 py-2 text-left text-sm text-n-slate-12 hover:bg-n-solid-3 transition-colors flex items-center gap-2\"\r\n            >\r\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\r\n              </svg>\r\n              Abrir Conversa\r\n            </button>\r\n            <hr class=\"my-1 border-n-weak\" />\r\n            <button\r\n              @click=\"resolveConversation\"\r\n              class=\"w-full px-4 py-2 text-left text-sm text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors flex items-center gap-2\"\r\n            >\r\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\r\n              </svg>\r\n              Resolver\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- T√≠tulo/Nome do Contato -->\r\n    <h3 class=\"font-semibold text-n-slate-12 mb-2 line-clamp-2\">\r\n      {{ conversation.meta.sender.name }}\r\n    </h3>\r\n\r\n    <!-- √öltima Mensagem -->\r\n    <p class=\"text-sm text-n-slate-11 mb-4 line-clamp-2\">\r\n      {{ lastMessage }}\r\n    </p>\r\n\r\n    <!-- Labels -->\r\n    <div v-if=\"conversation.labels && conversation.labels.length > 0\" class=\"flex flex-wrap gap-1 mb-3\">\r\n      <span\r\n        v-for=\"label in conversation.labels.slice(0, 3)\"\r\n        :key=\"label\"\r\n        class=\"px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 rounded\"\r\n      >\r\n        {{ label }}\r\n      </span>\r\n    </div>\r\n\r\n    <!-- Footer do Card -->\r\n    <div class=\"flex items-center justify-between pt-3 border-t border-n-weak\">\r\n      <div class=\"flex items-center gap-2\">\r\n        <img\r\n          v-if=\"conversation.meta.sender.thumbnail\"\r\n          :src=\"conversation.meta.sender.thumbnail\"\r\n          :alt=\"conversation.meta.sender.name\"\r\n          class=\"w-6 h-6 rounded-full object-cover\"\r\n        />\r\n        <div\r\n          v-else\r\n          class=\"w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-xs font-medium\"\r\n        >\r\n          {{ getInitials(conversation.meta.sender.name) }}\r\n        </div>\r\n        <span class=\"text-xs text-n-slate-11 truncate max-w-[120px]\">\r\n          {{ conversation.meta.sender.phone_number || 'Sem telefone' }}\r\n        </span>\r\n      </div>\r\n      \r\n      <div class=\"flex items-center gap-2 text-n-slate-11\">\r\n        <div v-if=\"conversation.unread_count > 0\" class=\"flex items-center gap-1\">\r\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z\" />\r\n          </svg>\r\n          <span class=\"text-xs font-medium bg-red-500 text-white px-1.5 py-0.5 rounded-full\">\r\n            {{ conversation.unread_count }}\r\n          </span>\r\n        </div>\r\n        <span class=\"text-xs\">{{ getTimeAgo(conversation.last_activity_at) }}</span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed } from 'vue';\r\nimport { useRouter } from 'vue-router';\r\nimport { useAccount } from 'dashboard/composables/useAccount';\r\nimport { vOnClickOutside } from '@vueuse/components';\r\n\r\nconst props = defineProps({\r\n  conversation: {\r\n    type: Object,\r\n    required: true,\r\n  },\r\n});\r\n\r\nconst emit = defineEmits(['dragstart', 'view-details']);\r\n\r\nconst router = useRouter();\r\nconst { accountScopedRoute } = useAccount();\r\nconst showMenu = ref(false);\r\n\r\nconst lastMessage = computed(() => {\r\n  if (props.conversation.last_non_activity_message) {\r\n    return props.conversation.last_non_activity_message.content || 'Sem mensagens';\r\n  }\r\n  return 'Sem mensagens';\r\n});\r\n\r\nconst getInitials = (name) => {\r\n  if (!name) return '?';\r\n  const parts = name.split(' ');\r\n  if (parts.length >= 2) {\r\n    return (parts[0][0] + parts[1][0]).toUpperCase();\r\n  }\r\n  return name.substring(0, 2).toUpperCase();\r\n};\r\n\r\nconst getTimeAgo = (timestamp) => {\r\n  if (!timestamp) return '';\r\n  \r\n  const now = Math.floor(Date.now() / 1000);\r\n  const diff = now - timestamp;\r\n  \r\n  if (diff < 60) return 'agora';\r\n  if (diff < 3600) return `${Math.floor(diff / 60)}m`;\r\n  if (diff < 86400) return `${Math.floor(diff / 3600)}h`;\r\n  return `${Math.floor(diff / 86400)}d`;\r\n};\r\n\r\nconst toggleMenu = () => {\r\n  showMenu.value = !showMenu.value;\r\n};\r\n\r\nconst closeMenu = () => {\r\n  showMenu.value = false;\r\n};\r\n\r\nconst viewDetails = () => {\r\n  closeMenu();\r\n  emit('view-details', props.conversation);\r\n};\r\n\r\nconst openConversation = () => {\r\n  closeMenu();\r\n  router.push(\r\n    accountScopedRoute('inbox_view_conversation', {\r\n      conversation_id: props.conversation.id,\r\n    })\r\n  );\r\n};\r\n\r\nconst resolveConversation = () => {\r\n  closeMenu();\r\n  console.log('Resolver conversa:', props.conversation.id);\r\n};\r\n</script>","<template>\r\n  <Teleport to=\"body\">\r\n    <Transition name=\"modal\">\r\n      <div\r\n        v-if=\"isOpen\"\r\n        class=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50\"\r\n        @click.self=\"closeModal\"\r\n      >\r\n        <div class=\"bg-white dark:bg-n-solid-3 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden\">\r\n          <!-- Header -->\r\n          <div class=\"flex items-center justify-between p-6 border-b border-n-weak\">\r\n            <div class=\"flex items-center gap-3\">\r\n              <img\r\n                v-if=\"conversation?.meta?.sender?.thumbnail\"\r\n                :src=\"conversation.meta.sender.thumbnail\"\r\n                :alt=\"conversation.meta.sender.name\"\r\n                class=\"w-10 h-10 rounded-full object-cover\"\r\n              />\r\n              <div\r\n                v-else\r\n                class=\"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-medium\"\r\n              >\r\n                {{ getInitials(conversation?.meta?.sender?.name) }}\r\n              </div>\r\n              <div>\r\n                <h2 class=\"text-xl font-semibold text-n-slate-12\">\r\n                  {{ conversation?.meta?.sender?.name }}\r\n                </h2>\r\n                <p class=\"text-sm text-n-slate-11\">#{{ conversation?.id }}</p>\r\n              </div>\r\n            </div>\r\n            <button\r\n              @click=\"closeModal\"\r\n              class=\"text-n-slate-10 hover:text-n-slate-12 transition-colors p-2 hover:bg-n-solid-4 rounded-lg\"\r\n            >\r\n              <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          <!-- Body -->\r\n          <div class=\"p-6 overflow-y-auto max-h-[calc(90vh-180px)]\">\r\n            <!-- Informa√ß√µes do Contato -->\r\n            <div class=\"mb-6\">\r\n              <label class=\"block text-sm font-medium text-n-slate-11 mb-2\">Informa√ß√µes de Contato</label>\r\n              <div class=\"p-4 bg-n-solid-2 rounded-lg space-y-2\">\r\n                <div class=\"flex items-center gap-2\">\r\n                  <svg class=\"w-4 h-4 text-n-slate-11\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\" />\r\n                  </svg>\r\n                  <span class=\"text-n-slate-12\">{{ conversation?.meta?.sender?.phone_number || 'N√£o informado' }}</span>\r\n                </div>\r\n                <div v-if=\"conversation?.meta?.sender?.email\" class=\"flex items-center gap-2\">\r\n                  <svg class=\"w-4 h-4 text-n-slate-11\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\r\n                  </svg>\r\n                  <span class=\"text-n-slate-12\">{{ conversation.meta.sender.email }}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Status e Labels -->\r\n            <div class=\"grid grid-cols-2 gap-4 mb-6\">\r\n              <div>\r\n                <label class=\"block text-sm font-medium text-n-slate-11 mb-2\">Status</label>\r\n                <span\r\n                  class=\"inline-flex px-3 py-1 rounded-full text-xs font-medium\"\r\n                  :class=\"{\r\n                    'bg-green-100 text-green-700 dark:bg-green-900/30': conversation?.status === 'open',\r\n                    'bg-gray-100 text-gray-700 dark:bg-gray-900/30': conversation?.status === 'resolved',\r\n                  }\"\r\n                >\r\n                  {{ conversation?.status === 'open' ? 'Aberta' : 'Resolvida' }}\r\n                </span>\r\n              </div>\r\n              \r\n              <div>\r\n                <label class=\"block text-sm font-medium text-n-slate-11 mb-2\">N√£o lidas</label>\r\n                <span class=\"text-2xl font-semibold text-n-slate-12\">\r\n                  {{ conversation?.unread_count || 0 }}\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Labels -->\r\n            <div v-if=\"conversation?.labels && conversation.labels.length > 0\" class=\"mb-6\">\r\n              <label class=\"block text-sm font-medium text-n-slate-11 mb-2\">Etiquetas</label>\r\n              <div class=\"flex flex-wrap gap-2\">\r\n                <span\r\n                  v-for=\"label in conversation.labels\"\r\n                  :key=\"label\"\r\n                  class=\"px-3 py-1 text-sm bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 rounded-full\"\r\n                >\r\n                  {{ label }}\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- √öltima Mensagem -->\r\n            <div class=\"mb-6\">\r\n              <label class=\"block text-sm font-medium text-n-slate-11 mb-2\">√öltima Mensagem</label>\r\n              <div class=\"p-4 bg-n-solid-2 rounded-lg\">\r\n                <p class=\"text-n-slate-12\">{{ lastMessage }}</p>\r\n                <p class=\"text-xs text-n-slate-11 mt-2\">{{ formatDate(conversation?.last_activity_at) }}</p>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Informa√ß√µes Adicionais -->\r\n            <div class=\"grid grid-cols-2 gap-4\">\r\n              <div class=\"p-4 bg-n-solid-2 rounded-lg\">\r\n                <div class=\"flex items-center gap-2 text-n-slate-11 mb-1\">\r\n                  <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                  </svg>\r\n                  <span class=\"text-sm\">Criada em</span>\r\n                </div>\r\n                <p class=\"text-sm font-medium text-n-slate-12\">\r\n                  {{ formatDate(conversation?.created_at) }}\r\n                </p>\r\n              </div>\r\n              \r\n              <div class=\"p-4 bg-n-solid-2 rounded-lg\">\r\n                <div class=\"flex items-center gap-2 text-n-slate-11 mb-1\">\r\n                  <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\r\n                  </svg>\r\n                  <span class=\"text-sm\">Canal</span>\r\n                </div>\r\n                <p class=\"text-sm font-medium text-n-slate-12\">\r\n                  {{ conversation?.meta?.channel || 'API' }}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Footer -->\r\n          <div class=\"flex items-center justify-end gap-3 p-6 border-t border-n-weak bg-n-solid-2\">\r\n            <button\r\n              @click=\"closeModal\"\r\n              class=\"px-4 py-2 text-sm font-medium text-n-slate-11 hover:text-n-slate-12 transition-colors\"\r\n            >\r\n              Fechar\r\n            </button>\r\n            <button\r\n              @click=\"openConversation\"\r\n              class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors\"\r\n            >\r\n              Abrir Conversa\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Transition>\r\n  </Teleport>\r\n</template>\r\n\r\n<script setup>\r\nimport { computed } from 'vue';\r\nimport { useRouter } from 'vue-router';\r\nimport { useAccount } from 'dashboard/composables/useAccount';\r\n\r\nconst props = defineProps({\r\n  isOpen: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n  conversation: {\r\n    type: Object,\r\n    default: null,\r\n  },\r\n});\r\n\r\nconst emit = defineEmits(['close']);\r\nconst router = useRouter();\r\nconst { accountScopedRoute } = useAccount();\r\n\r\nconst closeModal = () => {\r\n  emit('close');\r\n};\r\n\r\nconst lastMessage = computed(() => {\r\n  if (props.conversation?.last_non_activity_message) {\r\n    return props.conversation.last_non_activity_message.content || 'Sem mensagens';\r\n  }\r\n  return 'Sem mensagens';\r\n});\r\n\r\nconst getInitials = (name) => {\r\n  if (!name) return '?';\r\n  const parts = name.split(' ');\r\n  if (parts.length >= 2) {\r\n    return (parts[0][0] + parts[1][0]).toUpperCase();\r\n  }\r\n  return name.substring(0, 2).toUpperCase();\r\n};\r\n\r\nconst formatDate = (timestamp) => {\r\n  if (!timestamp) return 'N√£o dispon√≠vel';\r\n  \r\n  const date = new Date(timestamp * 1000);\r\n  return date.toLocaleString('pt-BR', {\r\n    day: '2-digit',\r\n    month: 'short',\r\n    year: 'numeric',\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n  });\r\n};\r\n\r\nconst openConversation = () => {\r\n  closeModal();\r\n  router.push(\r\n    accountScopedRoute('inbox_view_conversation', {\r\n      conversation_id: props.conversation.id,\r\n    })\r\n  );\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.modal-enter-active,\r\n.modal-leave-active {\r\n  transition: opacity 0.3s ease;\r\n}\r\n\r\n.modal-enter-from,\r\n.modal-leave-to {\r\n  opacity: 0;\r\n}\r\n\r\n.modal-enter-active .bg-white,\r\n.modal-leave-active .bg-white {\r\n  transition: transform 0.3s ease;\r\n}\r\n\r\n.modal-enter-from .bg-white,\r\n.modal-leave-to .bg-white {\r\n  transform: scale(0.9);\r\n}\r\n</style>","<template>\r\n  <div class=\"flex flex-col h-full bg-n-solid-1\">\r\n    <!-- Header -->\r\n    <div class=\"p-4 border-b border-n-weak bg-n-solid-2\">\r\n      <div class=\"flex items-center justify-between\">\r\n        <h1 class=\"text-2xl font-semibold text-n-slate-12\">Kanban de Conversas</h1>\r\n        <button\r\n          @click=\"refreshData\"\r\n          :disabled=\"isLoading\"\r\n          class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50\"\r\n        >\r\n          <span v-if=\"isLoading\">Carregando...</span>\r\n          <span v-else>üîÑ Atualizar</span>\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Loading State -->\r\n    <div v-if=\"isLoading && !hasConversations\" class=\"flex items-center justify-center flex-1\">\r\n      <div class=\"text-center\">\r\n        <div class=\"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\r\n        <p class=\"text-n-slate-11\">Carregando conversas...</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Kanban Board -->\r\n    <div v-else class=\"flex-1 overflow-x-auto p-4\">\r\n      <div class=\"flex gap-4 h-full min-w-max\">\r\n        <!-- Coluna: NOVO -->\r\n        <div class=\"flex flex-col w-80 bg-n-solid-2 rounded-lg\">\r\n          <div class=\"p-4 border-b border-n-weak\">\r\n            <div class=\"flex items-center justify-between\">\r\n              <h2 class=\"font-semibold text-n-slate-12\">NOVO</h2>\r\n              <span class=\"px-2 py-1 text-xs font-medium text-n-slate-11 bg-n-solid-3 rounded\">\r\n                {{ columns.novo.length }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div\r\n            class=\"flex-1 p-3 overflow-y-auto space-y-3\"\r\n            @drop=\"onDrop($event, 'novo')\"\r\n            @dragover.prevent\r\n            @dragenter.prevent\r\n          >\r\n            <KanbanCard\r\n              v-for=\"conversation in columns.novo\"\r\n              :key=\"conversation.id\"\r\n              :conversation=\"conversation\"\r\n              @dragstart=\"onDragStart($event, conversation)\"\r\n              @view-details=\"openDetailsModal\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Coluna: EM ANDAMENTO -->\r\n        <div class=\"flex flex-col w-80 bg-n-solid-2 rounded-lg\">\r\n          <div class=\"p-4 border-b border-n-weak\">\r\n            <div class=\"flex items-center justify-between\">\r\n              <h2 class=\"font-semibold text-n-slate-12\">EM ANDAMENTO</h2>\r\n              <span class=\"px-2 py-1 text-xs font-medium text-n-slate-11 bg-n-solid-3 rounded\">\r\n                {{ columns.emAndamento.length }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div\r\n            class=\"flex-1 p-3 overflow-y-auto space-y-3\"\r\n            @drop=\"onDrop($event, 'emAndamento')\"\r\n            @dragover.prevent\r\n            @dragenter.prevent\r\n          >\r\n            <KanbanCard\r\n              v-for=\"conversation in columns.emAndamento\"\r\n              :key=\"conversation.id\"\r\n              :conversation=\"conversation\"\r\n              @dragstart=\"onDragStart($event, conversation)\"\r\n              @view-details=\"openDetailsModal\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Coluna: AGUARDANDO -->\r\n        <div class=\"flex flex-col w-80 bg-n-solid-2 rounded-lg\">\r\n          <div class=\"p-4 border-b border-n-weak\">\r\n            <div class=\"flex items-center justify-between\">\r\n              <h2 class=\"font-semibold text-n-slate-12\">AGUARDANDO</h2>\r\n              <span class=\"px-2 py-1 text-xs font-medium text-n-slate-11 bg-n-solid-3 rounded\">\r\n                {{ columns.aguardando.length }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div\r\n            class=\"flex-1 p-3 overflow-y-auto space-y-3\"\r\n            @drop=\"onDrop($event, 'aguardando')\"\r\n            @dragover.prevent\r\n            @dragenter.prevent\r\n          >\r\n            <KanbanCard\r\n              v-for=\"conversation in columns.aguardando\"\r\n              :key=\"conversation.id\"\r\n              :conversation=\"conversation\"\r\n              @dragstart=\"onDragStart($event, conversation)\"\r\n              @view-details=\"openDetailsModal\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Coluna: EM AN√ÅLISE -->\r\n        <div class=\"flex flex-col w-80 bg-n-solid-2 rounded-lg\">\r\n          <div class=\"p-4 border-b border-n-weak\">\r\n            <div class=\"flex items-center justify-between\">\r\n              <h2 class=\"font-semibold text-n-slate-12\">EM AN√ÅLISE</h2>\r\n              <span class=\"px-2 py-1 text-xs font-medium text-n-slate-11 bg-n-solid-3 rounded\">\r\n                {{ columns.emAnalise.length }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div\r\n            class=\"flex-1 p-3 overflow-y-auto space-y-3\"\r\n            @drop=\"onDrop($event, 'emAnalise')\"\r\n            @dragover.prevent\r\n            @dragenter.prevent\r\n          >\r\n            <KanbanCard\r\n              v-for=\"conversation in columns.emAnalise\"\r\n              :key=\"conversation.id\"\r\n              :conversation=\"conversation\"\r\n              @dragstart=\"onDragStart($event, conversation)\"\r\n              @view-details=\"openDetailsModal\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Coluna: RESOLVIDO -->\r\n        <div class=\"flex flex-col w-80 bg-n-solid-2 rounded-lg\">\r\n          <div class=\"p-4 border-b border-n-weak\">\r\n            <div class=\"flex items-center justify-between\">\r\n              <h2 class=\"font-semibold text-n-slate-12\">RESOLVIDO</h2>\r\n              <span class=\"px-2 py-1 text-xs font-medium text-green-600 bg-green-50 dark:bg-green-900/20 rounded\">\r\n                {{ columns.resolvido.length }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div\r\n            class=\"flex-1 p-3 overflow-y-auto space-y-3\"\r\n            @drop=\"onDrop($event, 'resolvido')\"\r\n            @dragover.prevent\r\n            @dragenter.prevent\r\n          >\r\n            <KanbanCard\r\n              v-for=\"conversation in columns.resolvido\"\r\n              :key=\"conversation.id\"\r\n              :conversation=\"conversation\"\r\n              @dragstart=\"onDragStart($event, conversation)\"\r\n              @view-details=\"openDetailsModal\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Modal de Detalhes -->\r\n    <ConversationDetailModal\r\n      :is-open=\"isModalOpen\"\r\n      :conversation=\"selectedConversation\"\r\n      @close=\"closeDetailsModal\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted, computed } from 'vue';\r\nimport { useStore } from 'vuex';\r\nimport { useAccount } from 'dashboard/composables/useAccount';\r\nimport KanbanCard from './KanbanCard.vue';\r\nimport ConversationDetailModal from './ConversationDetailModal.vue';\r\nimport ConversationApi from '../../../api/inbox/conversation';\r\n\r\nconst store = useStore();\r\nconst { accountId } = useAccount();\r\n\r\nconst draggedConversation = ref(null);\r\nconst isModalOpen = ref(false);\r\nconst selectedConversation = ref(null);\r\nconst isLoading = ref(false);\r\n\r\nconst columns = reactive({\r\n  novo: [],\r\n  emAndamento: [],\r\n  aguardando: [],\r\n  emAnalise: [],\r\n  resolvido: [],\r\n});\r\n\r\nconst hasConversations = computed(() => {\r\n  return Object.values(columns).some(col => col.length > 0);\r\n});\r\n\r\n// Fun√ß√£o para buscar conversas da API\r\nconst fetchConversations = async () => {\r\n  isLoading.value = true;\r\n  try {\r\n    const params = {\r\n      status: 'open',\r\n      assignee_type: 'all',\r\n      page: 1,\r\n      sort_by: 'last_activity_at_desc',\r\n    };\r\n\r\n    const response = await ConversationApi.get(params);\r\n    \r\n    if (response.data && response.data.payload) {\r\n      distributeConversations(response.data.payload);\r\n    }\r\n  } catch (error) {\r\n    console.error('Erro ao buscar conversas:', error);\r\n  } finally {\r\n    isLoading.value = false;\r\n  }\r\n};\r\n\r\n// Distribui as conversas nas colunas baseado em custom_attributes\r\nconst distributeConversations = (conversations) => {\r\n  // Limpa as colunas\r\n  columns.novo = [];\r\n  columns.emAndamento = [];\r\n  columns.aguardando = [];\r\n  columns.emAnalise = [];\r\n  columns.resolvido = [];\r\n\r\n  conversations.forEach(conversation => {\r\n    const kanbanStatus = conversation.custom_attributes?.kanban_status;\r\n    \r\n    // Distribui baseado no custom_attribute kanban_status\r\n    switch(kanbanStatus) {\r\n      case 'em_andamento':\r\n        columns.emAndamento.push(conversation);\r\n        break;\r\n      case 'aguardando':\r\n        columns.aguardando.push(conversation);\r\n        break;\r\n      case 'em_analise':\r\n        columns.emAnalise.push(conversation);\r\n        break;\r\n      case 'resolvido':\r\n        columns.resolvido.push(conversation);\r\n        break;\r\n      default:\r\n        // Se n√£o tem status, vai para NOVO\r\n        columns.novo.push(conversation);\r\n    }\r\n  });\r\n};\r\n\r\nconst onDragStart = (event, conversation) => {\r\n  draggedConversation.value = conversation;\r\n  event.dataTransfer.effectAllowed = 'move';\r\n};\r\n\r\nconst onDrop = async (event, targetColumn) => {\r\n  event.preventDefault();\r\n  \r\n  if (!draggedConversation.value) return;\r\n\r\n  const conversationId = draggedConversation.value.id;\r\n  \r\n  // Remove da coluna original\r\n  for (const column in columns) {\r\n    const index = columns[column].findIndex(c => c.id === conversationId);\r\n    if (index !== -1) {\r\n      columns[column].splice(index, 1);\r\n      break;\r\n    }\r\n  }\r\n\r\n  // Adiciona na nova coluna\r\n  columns[targetColumn].push(draggedConversation.value);\r\n  \r\n  // Atualiza o custom_attribute na API\r\n  try {\r\n    await updateConversationStatus(conversationId, targetColumn);\r\n  } catch (error) {\r\n    console.error('Erro ao atualizar status:', error);\r\n    // Se der erro, recarrega as conversas\r\n    fetchConversations();\r\n  }\r\n  \r\n  draggedConversation.value = null;\r\n};\r\n\r\nconst updateConversationStatus = async (conversationId, status) => {\r\n  try {\r\n    await ConversationApi.updateCustomAttributes(conversationId, {\r\n      kanban_status: status,\r\n    });\r\n    \r\n    // Atualiza o store local\r\n    store.commit('UPDATE_CONVERSATION_CUSTOM_ATTRIBUTES', {\r\n      kanban_status: status,\r\n    });\r\n  } catch (error) {\r\n    console.error('Erro ao atualizar custom attributes:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst refreshData = () => {\r\n  fetchConversations();\r\n};\r\n\r\nconst openDetailsModal = (conversation) => {\r\n  selectedConversation.value = conversation;\r\n  isModalOpen.value = true;\r\n};\r\n\r\nconst closeDetailsModal = () => {\r\n  isModalOpen.value = false;\r\n  selectedConversation.value = null;\r\n};\r\n\r\nonMounted(() => {\r\n  fetchConversations();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.no-scrollbar::-webkit-scrollbar {\r\n  display: none;\r\n}\r\n\r\n.no-scrollbar {\r\n  -ms-overflow-style: none;\r\n  scrollbar-width: none;\r\n}\r\n</style>"],"names":["props","__props","emit","__emit","router","useRouter","accountScopedRoute","useAccount","showMenu","ref","lastMessage","computed","getInitials","name","parts","getTimeAgo","timestamp","diff","toggleMenu","closeMenu","viewDetails","openConversation","resolveConversation","closeModal","_a","formatDate","store","useStore","draggedConversation","isModalOpen","selectedConversation","isLoading","columns","reactive","hasConversations","col","fetchConversations","params","response","ConversationApi","distributeConversations","error","conversations","conversation","onDragStart","event","onDrop","targetColumn","conversationId","column","index","c","updateConversationStatus","status","refreshData","openDetailsModal","closeDetailsModal","onMounted"],"mappings":"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"}