{"version":3,"file":"Index-BlS8Jex0.js","sources":["../../../app/javascript/dashboard/routes/dashboard/kanban/KanbanCard.vue","../../../app/javascript/dashboard/routes/dashboard/kanban/ConversationDetailModal.vue","../../../app/javascript/dashboard/routes/dashboard/kanban/Index.vue"],"sourcesContent":["<template>\r\n  <div\r\n    draggable=\"true\"\r\n    class=\"bg-white dark:bg-n-solid-3 p-4 rounded-lg border border-n-weak cursor-move hover:shadow-lg transition-all duration-200 hover:scale-[1.02]\"\r\n    @dragstart=\"$emit('dragstart', $event)\"\r\n  >\r\n    <!-- Header do Card -->\r\n    <div class=\"flex items-start justify-between mb-3\">\r\n      <div class=\"flex items-center gap-2\">\r\n        <span class=\"px-2 py-0.5 text-xs font-medium text-green-700 bg-green-100 dark:bg-green-900/30 dark:text-green-400 rounded\">\r\n          #{{ conversation.id }}\r\n        </span>\r\n        <span\r\n          v-if=\"conversation.priority\"\r\n          class=\"w-2 h-2 rounded-full\"\r\n          :class=\"{\r\n            'bg-red-500': conversation.priority === 'urgent',\r\n            'bg-yellow-500': conversation.priority === 'high',\r\n            'bg-blue-500': conversation.priority === 'medium',\r\n          }\"\r\n        ></span>\r\n      </div>\r\n      \r\n      <!-- Menu Dropdown -->\r\n      <div class=\"relative\">\r\n        <button \r\n          @click.stop=\"toggleMenu\"\r\n          class=\"text-n-slate-10 hover:text-n-slate-12 transition-colors p-1 hover:bg-n-solid-4 rounded\"\r\n        >\r\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z\" />\r\n          </svg>\r\n        </button>\r\n\r\n        <!-- Dropdown Menu -->\r\n        <div\r\n          v-if=\"showMenu\"\r\n          v-on-click-outside=\"closeMenu\"\r\n          class=\"absolute right-0 mt-1 w-48 bg-white dark:bg-n-solid-4 rounded-lg shadow-lg border border-n-weak z-50\"\r\n        >\r\n          <div class=\"py-1\">\r\n            <button\r\n              @click=\"viewDetails\"\r\n              class=\"w-full px-4 py-2 text-left text-sm text-n-slate-12 hover:bg-n-solid-3 transition-colors flex items-center gap-2\"\r\n            >\r\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n              </svg>\r\n              Ver Detalhes\r\n            </button>\r\n            <button\r\n              @click=\"openConversation\"\r\n              class=\"w-full px-4 py-2 text-left text-sm text-n-slate-12 hover:bg-n-solid-3 transition-colors flex items-center gap-2\"\r\n            >\r\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\r\n              </svg>\r\n              Abrir Conversa\r\n            </button>\r\n            <hr class=\"my-1 border-n-weak\" />\r\n            <button\r\n              @click=\"resolveConversation\"\r\n              class=\"w-full px-4 py-2 text-left text-sm text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors flex items-center gap-2\"\r\n            >\r\n              <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5 13l4 4L19 7\" />\r\n              </svg>\r\n              Resolver\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- TÃ­tulo/Nome do Contato -->\r\n    <h3 class=\"font-semibold text-n-slate-12 mb-2 line-clamp-2\">\r\n      {{ conversation.meta.sender.name }}\r\n    </h3>\r\n\r\n    <!-- Ãšltima Mensagem -->\r\n    <p class=\"text-sm text-n-slate-11 mb-4 line-clamp-2\">\r\n      {{ lastMessage }}\r\n    </p>\r\n\r\n    <!-- Labels -->\r\n    <div v-if=\"conversation.labels && conversation.labels.length > 0\" class=\"flex flex-wrap gap-1 mb-3\">\r\n      <span\r\n        v-for=\"label in conversation.labels.slice(0, 3)\"\r\n        :key=\"label\"\r\n        class=\"px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 rounded\"\r\n      >\r\n        {{ label }}\r\n      </span>\r\n    </div>\r\n\r\n    <!-- Footer do Card -->\r\n    <div class=\"flex items-center justify-between pt-3 border-t border-n-weak\">\r\n      <div class=\"flex items-center gap-2\">\r\n        <img\r\n          v-if=\"conversation.meta.sender.thumbnail\"\r\n          :src=\"conversation.meta.sender.thumbnail\"\r\n          :alt=\"conversation.meta.sender.name\"\r\n          class=\"w-6 h-6 rounded-full object-cover\"\r\n        />\r\n        <div\r\n          v-else\r\n          class=\"w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-xs font-medium\"\r\n        >\r\n          {{ getInitials(conversation.meta.sender.name) }}\r\n        </div>\r\n        <span class=\"text-xs text-n-slate-11 truncate max-w-[120px]\">\r\n          {{ conversation.meta.sender.phone_number || 'Sem telefone' }}\r\n        </span>\r\n      </div>\r\n      \r\n      <div class=\"flex items-center gap-2 text-n-slate-11\">\r\n        <div v-if=\"conversation.unread_count > 0\" class=\"flex items-center gap-1\">\r\n          <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z\" />\r\n          </svg>\r\n          <span class=\"text-xs font-medium bg-red-500 text-white px-1.5 py-0.5 rounded-full\">\r\n            {{ conversation.unread_count }}\r\n          </span>\r\n        </div>\r\n        <span class=\"text-xs\">{{ getTimeAgo(conversation.last_activity_at) }}</span>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed } from 'vue';\r\nimport { useRouter } from 'vue-router';\r\nimport { useAccount } from 'dashboard/composables/useAccount';\r\nimport { vOnClickOutside } from '@vueuse/components';\r\n\r\nconst props = defineProps({\r\n  conversation: {\r\n    type: Object,\r\n    required: true,\r\n  },\r\n});\r\n\r\nconst emit = defineEmits(['dragstart', 'view-details']);\r\n\r\nconst router = useRouter();\r\nconst { accountScopedRoute } = useAccount();\r\nconst showMenu = ref(false);\r\n\r\nconst lastMessage = computed(() => {\r\n  if (props.conversation.last_non_activity_message) {\r\n    return props.conversation.last_non_activity_message.content || 'Sem mensagens';\r\n  }\r\n  return 'Sem mensagens';\r\n});\r\n\r\nconst getInitials = (name) => {\r\n  if (!name) return '?';\r\n  const parts = name.split(' ');\r\n  if (parts.length >= 2) {\r\n    return (parts[0][0] + parts[1][0]).toUpperCase();\r\n  }\r\n  return name.substring(0, 2).toUpperCase();\r\n};\r\n\r\nconst getTimeAgo = (timestamp) => {\r\n  if (!timestamp) return '';\r\n  \r\n  const now = Math.floor(Date.now() / 1000);\r\n  const diff = now - timestamp;\r\n  \r\n  if (diff < 60) return 'agora';\r\n  if (diff < 3600) return `${Math.floor(diff / 60)}m`;\r\n  if (diff < 86400) return `${Math.floor(diff / 3600)}h`;\r\n  return `${Math.floor(diff / 86400)}d`;\r\n};\r\n\r\nconst toggleMenu = () => {\r\n  showMenu.value = !showMenu.value;\r\n};\r\n\r\nconst closeMenu = () => {\r\n  showMenu.value = false;\r\n};\r\n\r\nconst viewDetails = () => {\r\n  closeMenu();\r\n  emit('view-details', props.conversation);\r\n};\r\n\r\nconst openConversation = () => {\r\n  closeMenu();\r\n  router.push(\r\n    accountScopedRoute('inbox_view_conversation', {\r\n      conversation_id: props.conversation.id,\r\n    })\r\n  );\r\n};\r\n\r\nconst resolveConversation = () => {\r\n  closeMenu();\r\n  console.log('Resolver conversa:', props.conversation.id);\r\n};\r\n</script>","<template>\r\n  <Teleport to=\"body\">\r\n    <Transition name=\"modal\">\r\n      <div\r\n        v-if=\"isOpen\"\r\n        class=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50\"\r\n        @click.self=\"closeModal\"\r\n      >\r\n        <div class=\"bg-white dark:bg-n-solid-3 rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden\">\r\n          <!-- Header -->\r\n          <div class=\"flex items-center justify-between p-6 border-b border-n-weak\">\r\n            <div class=\"flex items-center gap-3\">\r\n              <img\r\n                v-if=\"conversation?.meta?.sender?.thumbnail\"\r\n                :src=\"conversation.meta.sender.thumbnail\"\r\n                :alt=\"conversation.meta.sender.name\"\r\n                class=\"w-10 h-10 rounded-full object-cover\"\r\n              />\r\n              <div\r\n                v-else\r\n                class=\"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-medium\"\r\n              >\r\n                {{ getInitials(conversation?.meta?.sender?.name) }}\r\n              </div>\r\n              <div>\r\n                <h2 class=\"text-xl font-semibold text-n-slate-12\">\r\n                  {{ conversation?.meta?.sender?.name }}\r\n                </h2>\r\n                <p class=\"text-sm text-n-slate-11\">#{{ conversation?.id }}</p>\r\n              </div>\r\n            </div>\r\n            <button\r\n              @click=\"closeModal\"\r\n              class=\"text-n-slate-10 hover:text-n-slate-12 transition-colors p-2 hover:bg-n-solid-4 rounded-lg\"\r\n            >\r\n              <svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" />\r\n              </svg>\r\n            </button>\r\n          </div>\r\n\r\n          <!-- Body -->\r\n          <div class=\"p-6 overflow-y-auto max-h-[calc(90vh-180px)]\">\r\n            <!-- InformaÃ§Ãµes do Contato -->\r\n            <div class=\"mb-6\">\r\n              <label class=\"block text-sm font-medium text-n-slate-11 mb-2\">InformaÃ§Ãµes de Contato</label>\r\n              <div class=\"p-4 bg-n-solid-2 rounded-lg space-y-2\">\r\n                <div class=\"flex items-center gap-2\">\r\n                  <svg class=\"w-4 h-4 text-n-slate-11\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\" />\r\n                  </svg>\r\n                  <span class=\"text-n-slate-12\">{{ conversation?.meta?.sender?.phone_number || 'NÃ£o informado' }}</span>\r\n                </div>\r\n                <div v-if=\"conversation?.meta?.sender?.email\" class=\"flex items-center gap-2\">\r\n                  <svg class=\"w-4 h-4 text-n-slate-11\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\r\n                  </svg>\r\n                  <span class=\"text-n-slate-12\">{{ conversation.meta.sender.email }}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Status e Labels -->\r\n            <div class=\"grid grid-cols-2 gap-4 mb-6\">\r\n              <div>\r\n                <label class=\"block text-sm font-medium text-n-slate-11 mb-2\">Status</label>\r\n                <span\r\n                  class=\"inline-flex px-3 py-1 rounded-full text-xs font-medium\"\r\n                  :class=\"{\r\n                    'bg-green-100 text-green-700 dark:bg-green-900/30': conversation?.status === 'open',\r\n                    'bg-gray-100 text-gray-700 dark:bg-gray-900/30': conversation?.status === 'resolved',\r\n                  }\"\r\n                >\r\n                  {{ conversation?.status === 'open' ? 'Aberta' : 'Resolvida' }}\r\n                </span>\r\n              </div>\r\n              \r\n              <div>\r\n                <label class=\"block text-sm font-medium text-n-slate-11 mb-2\">NÃ£o lidas</label>\r\n                <span class=\"text-2xl font-semibold text-n-slate-12\">\r\n                  {{ conversation?.unread_count || 0 }}\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Labels -->\r\n            <div v-if=\"conversation?.labels && conversation.labels.length > 0\" class=\"mb-6\">\r\n              <label class=\"block text-sm font-medium text-n-slate-11 mb-2\">Etiquetas</label>\r\n              <div class=\"flex flex-wrap gap-2\">\r\n                <span\r\n                  v-for=\"label in conversation.labels\"\r\n                  :key=\"label\"\r\n                  class=\"px-3 py-1 text-sm bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 rounded-full\"\r\n                >\r\n                  {{ label }}\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Ãšltima Mensagem -->\r\n            <div class=\"mb-6\">\r\n              <label class=\"block text-sm font-medium text-n-slate-11 mb-2\">Ãšltima Mensagem</label>\r\n              <div class=\"p-4 bg-n-solid-2 rounded-lg\">\r\n                <p class=\"text-n-slate-12\">{{ lastMessage }}</p>\r\n                <p class=\"text-xs text-n-slate-11 mt-2\">{{ formatDate(conversation?.last_activity_at) }}</p>\r\n              </div>\r\n            </div>\r\n\r\n            <!-- InformaÃ§Ãµes Adicionais -->\r\n            <div class=\"grid grid-cols-2 gap-4\">\r\n              <div class=\"p-4 bg-n-solid-2 rounded-lg\">\r\n                <div class=\"flex items-center gap-2 text-n-slate-11 mb-1\">\r\n                  <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                  </svg>\r\n                  <span class=\"text-sm\">Criada em</span>\r\n                </div>\r\n                <p class=\"text-sm font-medium text-n-slate-12\">\r\n                  {{ formatDate(conversation?.created_at) }}\r\n                </p>\r\n              </div>\r\n              \r\n              <div class=\"p-4 bg-n-solid-2 rounded-lg\">\r\n                <div class=\"flex items-center gap-2 text-n-slate-11 mb-1\">\r\n                  <svg class=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\r\n                  </svg>\r\n                  <span class=\"text-sm\">Canal</span>\r\n                </div>\r\n                <p class=\"text-sm font-medium text-n-slate-12\">\r\n                  {{ conversation?.meta?.channel || 'API' }}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Footer -->\r\n          <div class=\"flex items-center justify-end gap-3 p-6 border-t border-n-weak bg-n-solid-2\">\r\n            <button\r\n              @click=\"closeModal\"\r\n              class=\"px-4 py-2 text-sm font-medium text-n-slate-11 hover:text-n-slate-12 transition-colors\"\r\n            >\r\n              Fechar\r\n            </button>\r\n            <button\r\n              @click=\"openConversation\"\r\n              class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors\"\r\n            >\r\n              Abrir Conversa\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Transition>\r\n  </Teleport>\r\n</template>\r\n\r\n<script setup>\r\nimport { computed } from 'vue';\r\nimport { useRouter } from 'vue-router';\r\nimport { useAccount } from 'dashboard/composables/useAccount';\r\n\r\nconst props = defineProps({\r\n  isOpen: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n  conversation: {\r\n    type: Object,\r\n    default: null,\r\n  },\r\n});\r\n\r\nconst emit = defineEmits(['close']);\r\nconst router = useRouter();\r\nconst { accountScopedRoute } = useAccount();\r\n\r\nconst closeModal = () => {\r\n  emit('close');\r\n};\r\n\r\nconst lastMessage = computed(() => {\r\n  if (props.conversation?.last_non_activity_message) {\r\n    return props.conversation.last_non_activity_message.content || 'Sem mensagens';\r\n  }\r\n  return 'Sem mensagens';\r\n});\r\n\r\nconst getInitials = (name) => {\r\n  if (!name) return '?';\r\n  const parts = name.split(' ');\r\n  if (parts.length >= 2) {\r\n    return (parts[0][0] + parts[1][0]).toUpperCase();\r\n  }\r\n  return name.substring(0, 2).toUpperCase();\r\n};\r\n\r\nconst formatDate = (timestamp) => {\r\n  if (!timestamp) return 'NÃ£o disponÃ­vel';\r\n  \r\n  const date = new Date(timestamp * 1000);\r\n  return date.toLocaleString('pt-BR', {\r\n    day: '2-digit',\r\n    month: 'short',\r\n    year: 'numeric',\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n  });\r\n};\r\n\r\nconst openConversation = () => {\r\n  closeModal();\r\n  router.push(\r\n    accountScopedRoute('inbox_view_conversation', {\r\n      conversation_id: props.conversation.id,\r\n    })\r\n  );\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.modal-enter-active,\r\n.modal-leave-active {\r\n  transition: opacity 0.3s ease;\r\n}\r\n\r\n.modal-enter-from,\r\n.modal-leave-to {\r\n  opacity: 0;\r\n}\r\n\r\n.modal-enter-active .bg-white,\r\n.modal-leave-active .bg-white {\r\n  transition: transform 0.3s ease;\r\n}\r\n\r\n.modal-enter-from .bg-white,\r\n.modal-leave-to .bg-white {\r\n  transform: scale(0.9);\r\n}\r\n</style>","<template>\r\n  <div class=\"flex flex-col h-full bg-n-solid-1\">\r\n    <!-- Header -->\r\n    <div class=\"p-4 border-b border-n-weak bg-n-solid-2\">\r\n      <div class=\"flex items-center justify-between\">\r\n        <h1 class=\"text-2xl font-semibold text-n-slate-12\">Kanban de Conversas</h1>\r\n        <button\r\n          @click=\"refreshData\"\r\n          :disabled=\"isLoading\"\r\n          class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50\"\r\n        >\r\n          <span v-if=\"isLoading\">Carregando...</span>\r\n          <span v-else>ðŸ”„ Atualizar</span>\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Debug Info -->\r\n    <div class=\"p-2 text-xs text-n-slate-11 border-b border-n-weak\">\r\n      Labels carregadas: {{ labelColumns.length }} | \r\n      Sem etiqueta: {{ columns.semEtiqueta?.length || 0 }} | \r\n      Total conversas: {{ totalConversations }}\r\n    </div>\r\n\r\n    <!-- Loading State -->\r\n    <div v-if=\"isLoading && !hasConversations\" class=\"flex items-center justify-center flex-1\">\r\n      <div class=\"text-center\">\r\n        <div class=\"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\r\n        <p class=\"text-n-slate-11\">Carregando conversas...</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Empty State -->\r\n    <div v-else-if=\"!isLoading && !hasConversations\" class=\"flex items-center justify-center flex-1\">\r\n      <div class=\"text-center\">\r\n        <p class=\"text-n-slate-11 mb-4\">Nenhuma conversa encontrada</p>\r\n        <button\r\n          @click=\"refreshData\"\r\n          class=\"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors\"\r\n        >\r\n          Atualizar\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Kanban Board -->\r\n    <div v-else class=\"flex-1 overflow-x-auto p-4\">\r\n      <div class=\"flex gap-4 h-full min-w-max\">\r\n        <!-- Coluna: SEM ETIQUETA -->\r\n        <div class=\"flex flex-col w-80 bg-n-solid-2 rounded-lg\">\r\n          <div class=\"p-4 border-b border-n-weak\">\r\n            <div class=\"flex items-center justify-between\">\r\n              <div class=\"flex items-center gap-2\">\r\n                <span class=\"w-3 h-3 rounded-full bg-gray-400\"></span>\r\n                <h2 class=\"font-semibold text-n-slate-12\">SEM ETIQUETA</h2>\r\n              </div>\r\n              <span class=\"px-2 py-1 text-xs font-medium text-n-slate-11 bg-n-solid-3 rounded\">\r\n                {{ columns.semEtiqueta?.length || 0 }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div\r\n            class=\"flex-1 p-3 overflow-y-auto space-y-3\"\r\n            @drop=\"onDrop($event, null)\"\r\n            @dragover.prevent\r\n            @dragenter.prevent\r\n          >\r\n            <KanbanCard\r\n              v-for=\"conversation in columns.semEtiqueta\"\r\n              :key=\"conversation.id\"\r\n              :conversation=\"conversation\"\r\n              @dragstart=\"onDragStart($event, conversation)\"\r\n              @view-details=\"openDetailsModal\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Colunas DinÃ¢micas baseadas nas Labels -->\r\n        <div\r\n          v-for=\"label in labelColumns\"\r\n          :key=\"label.id\"\r\n          class=\"flex flex-col w-80 bg-n-solid-2 rounded-lg\"\r\n        >\r\n          <div class=\"p-4 border-b border-n-weak\">\r\n            <div class=\"flex items-center justify-between\">\r\n              <div class=\"flex items-center gap-2\">\r\n                <span\r\n                  class=\"w-3 h-3 rounded-full ring-1 ring-black/10 dark:ring-white/20\"\r\n                  :style=\"{ backgroundColor: label.color }\"\r\n                ></span>\r\n                <h2 class=\"font-semibold text-n-slate-12\">{{ label.title.toUpperCase() }}</h2>\r\n              </div>\r\n              <span class=\"px-2 py-1 text-xs font-medium text-n-slate-11 bg-n-solid-3 rounded\">\r\n                {{ columns[label.title]?.length || 0 }}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div\r\n            class=\"flex-1 p-3 overflow-y-auto space-y-3\"\r\n            @drop=\"onDrop($event, label.title)\"\r\n            @dragover.prevent\r\n            @dragenter.prevent\r\n          >\r\n            <KanbanCard\r\n              v-for=\"conversation in columns[label.title]\"\r\n              :key=\"conversation.id\"\r\n              :conversation=\"conversation\"\r\n              @dragstart=\"onDragStart($event, conversation)\"\r\n              @view-details=\"openDetailsModal\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Modal de Detalhes -->\r\n    <ConversationDetailModal\r\n      :is-open=\"isModalOpen\"\r\n      :conversation=\"selectedConversation\"\r\n      @close=\"closeDetailsModal\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted, computed } from 'vue';\r\nimport { useStore } from 'vuex';\r\nimport { useMapGetter } from 'dashboard/composables/store';\r\nimport KanbanCard from './KanbanCard.vue';\r\nimport ConversationDetailModal from './ConversationDetailModal.vue';\r\nimport ConversationApi from '../../../api/inbox/conversation';\r\n\r\nconst store = useStore();\r\n\r\nconst draggedConversation = ref(null);\r\nconst isModalOpen = ref(false);\r\nconst selectedConversation = ref(null);\r\nconst isLoading = ref(false);\r\n\r\n// Busca as labels do store\r\nconst allLabels = useMapGetter('labels/getLabels');\r\n\r\nconst columns = reactive({\r\n  semEtiqueta: [],\r\n});\r\n\r\n// Cria um computed para as colunas de labels\r\nconst labelColumns = computed(() => {\r\n  return allLabels.value || [];\r\n});\r\n\r\nconst totalConversations = computed(() => {\r\n  let total = columns.semEtiqueta?.length || 0;\r\n  labelColumns.value.forEach(label => {\r\n    total += columns[label.title]?.length || 0;\r\n  });\r\n  return total;\r\n});\r\n\r\nconst hasConversations = computed(() => {\r\n  return totalConversations.value > 0;\r\n});\r\n\r\n// FunÃ§Ã£o para buscar conversas da API\r\nconst fetchConversations = async () => {\r\n  isLoading.value = true;\r\n  try {\r\n    console.log('ðŸ” Buscando conversas...');\r\n    \r\n    const response = await ConversationApi.get({\r\n      status: 'open',\r\n      assigneeType: 'all',\r\n      page: 1,\r\n      sortBy: 'last_activity_at',\r\n    });\r\n    \r\n    console.log('ðŸ“¦ Resposta da API:', response);\r\n    \r\n    if (response.data && response.data.payload) {\r\n      console.log('âœ… Total de conversas:', response.data.payload.length);\r\n      distributeConversations(response.data.payload);\r\n    } else {\r\n      console.warn('âš ï¸ Nenhuma conversa encontrada na resposta');\r\n    }\r\n  } catch (error) {\r\n    console.error('âŒ Erro ao buscar conversas:', error);\r\n  } finally {\r\n    isLoading.value = false;\r\n  }\r\n};\r\n\r\n// Distribui as conversas nas colunas baseado nas labels\r\nconst distributeConversations = (conversations) => {\r\n  console.log('ðŸ“Š Distribuindo conversas...');\r\n  console.log('Labels disponÃ­veis:', labelColumns.value.map(l => l.title));\r\n  \r\n  // Limpa todas as colunas\r\n  columns.semEtiqueta = [];\r\n  \r\n  // Cria colunas para cada label dinamicamente\r\n  labelColumns.value.forEach(label => {\r\n    if (!columns[label.title]) {\r\n      columns[label.title] = [];\r\n    } else {\r\n      columns[label.title] = [];\r\n    }\r\n    console.log(`ðŸ“ Coluna criada: ${label.title}`);\r\n  });\r\n\r\n  // Distribui as conversas\r\n  conversations.forEach(conversation => {\r\n    console.log(`\\nðŸ”„ Processando conversa #${conversation.id}`);\r\n    console.log(`   Labels:`, conversation.labels);\r\n    console.log(`   Sender:`, conversation.meta?.sender?.name);\r\n    \r\n    if (!conversation.labels || conversation.labels.length === 0) {\r\n      // Sem etiqueta\r\n      columns.semEtiqueta.push(conversation);\r\n      console.log(`   âœ… Adicionado em SEM ETIQUETA`);\r\n    } else {\r\n      // Pega a primeira label da conversa\r\n      const firstLabel = conversation.labels[0];\r\n      console.log(`   ðŸ·ï¸ Primeira label: \"${firstLabel}\"`);\r\n      \r\n      // Verifica se a coluna existe\r\n      if (columns[firstLabel] !== undefined) {\r\n        columns[firstLabel].push(conversation);\r\n        console.log(`   âœ… Adicionado na coluna \"${firstLabel}\"`);\r\n      } else {\r\n        // Se nÃ£o existe, adiciona em sem etiqueta\r\n        columns.semEtiqueta.push(conversation);\r\n        console.log(`   âš ï¸ Coluna \"${firstLabel}\" nÃ£o encontrada, adicionado em SEM ETIQUETA`);\r\n      }\r\n    }\r\n  });\r\n  \r\n  console.log('\\nðŸ“Š Resumo da distribuiÃ§Ã£o:');\r\n  console.log(`   SEM ETIQUETA: ${columns.semEtiqueta.length} conversas`);\r\n  labelColumns.value.forEach(label => {\r\n    console.log(`   ${label.title}: ${columns[label.title]?.length || 0} conversas`);\r\n  });\r\n};\r\n\r\nconst onDragStart = (event, conversation) => {\r\n  draggedConversation.value = conversation;\r\n  event.dataTransfer.effectAllowed = 'move';\r\n};\r\n\r\nconst onDrop = async (event, targetLabel) => {\r\n  event.preventDefault();\r\n  \r\n  if (!draggedConversation.value) return;\r\n\r\n  const conversationId = draggedConversation.value.id;\r\n  \r\n  console.log(`ðŸŽ¯ Movendo conversa #${conversationId} para:`, targetLabel || 'SEM ETIQUETA');\r\n  \r\n  // Remove da coluna original\r\n  for (const column in columns) {\r\n    const index = columns[column].findIndex(c => c.id === conversationId);\r\n    if (index !== -1) {\r\n      columns[column].splice(index, 1);\r\n      console.log(`   âœ‚ï¸ Removido da coluna: ${column}`);\r\n      break;\r\n    }\r\n  }\r\n\r\n  // Atualiza as labels localmente\r\n  if (targetLabel === null) {\r\n    // Moveu para \"Sem Etiqueta\" - remove todas as labels\r\n    draggedConversation.value.labels = [];\r\n    columns.semEtiqueta.push(draggedConversation.value);\r\n    console.log(`   âœ… Adicionado em SEM ETIQUETA`);\r\n  } else {\r\n    // Moveu para uma label especÃ­fica\r\n    draggedConversation.value.labels = [targetLabel];\r\n    if (!columns[targetLabel]) {\r\n      columns[targetLabel] = [];\r\n    }\r\n    columns[targetLabel].push(draggedConversation.value);\r\n    console.log(`   âœ… Adicionado na coluna: ${targetLabel}`);\r\n  }\r\n  \r\n  // Atualiza as labels na API\r\n  try {\r\n    await updateConversationLabels(conversationId, targetLabel);\r\n  } catch (error) {\r\n    console.error('âŒ Erro ao atualizar labels:', error);\r\n    // Se der erro, recarrega as conversas\r\n    fetchConversations();\r\n  }\r\n  \r\n  draggedConversation.value = null;\r\n};\r\n\r\nconst updateConversationLabels = async (conversationId, newLabel) => {\r\n  try {\r\n    const labels = newLabel === null ? [] : [newLabel];\r\n    \r\n    console.log(`ðŸ“¡ Atualizando labels na API para conversa #${conversationId}:`, labels);\r\n    \r\n    await ConversationApi.updateLabels(conversationId, labels);\r\n    \r\n    console.log(`âœ… Labels atualizadas com sucesso`);\r\n  } catch (error) {\r\n    console.error('âŒ Erro ao atualizar labels:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nconst refreshData = () => {\r\n  fetchConversations();\r\n};\r\n\r\nconst openDetailsModal = (conversation) => {\r\n  selectedConversation.value = conversation;\r\n  isModalOpen.value = true;\r\n};\r\n\r\nconst closeDetailsModal = () => {\r\n  isModalOpen.value = false;\r\n  selectedConversation.value = null;\r\n};\r\n\r\nonMounted(async () => {\r\n  console.log('ðŸš€ Iniciando Kanban...');\r\n  \r\n  // Carrega as labels primeiro\r\n  console.log('ðŸ“¥ Carregando labels...');\r\n  await store.dispatch('labels/get');\r\n  console.log('âœ… Labels carregadas:', allLabels.value);\r\n  \r\n  // Depois carrega as conversas\r\n  await fetchConversations();\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.no-scrollbar::-webkit-scrollbar {\r\n  display: none;\r\n}\r\n\r\n.no-scrollbar {\r\n  -ms-overflow-style: none;\r\n  scrollbar-width: none;\r\n}\r\n</style>"],"names":["props","__props","emit","__emit","router","useRouter","accountScopedRoute","useAccount","showMenu","ref","lastMessage","computed","getInitials","name","parts","getTimeAgo","timestamp","diff","toggleMenu","closeMenu","viewDetails","openConversation","resolveConversation","closeModal","_a","formatDate","store","useStore","draggedConversation","isModalOpen","selectedConversation","isLoading","allLabels","useMapGetter","columns","reactive","labelColumns","totalConversations","total","label","hasConversations","fetchConversations","response","ConversationApi","distributeConversations","error","conversations","l","conversation","_b","firstLabel","onDragStart","event","onDrop","targetLabel","conversationId","column","index","c","updateConversationLabels","newLabel","labels","refreshData","openDetailsModal","closeDetailsModal","onMounted"],"mappings":"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"}